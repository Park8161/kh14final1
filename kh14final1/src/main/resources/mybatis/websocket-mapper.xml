<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="websocketMessage">

	<select id="sequence" resultType="int">
		select websocket_message_seq.nextval from dual
	</select>

	<insert id="add">
		insert into websocket_message(
			websocket_message_no, websocket_message_type, websocket_message_sender,
			websocket_message_receiver, websocket_message_content
		)
		values(
			#{websocketMessageNo}, #{websocketMessageType}, #{websocketMessageSender},
			#{websocketMessageReceiver, jdbcType=VARCHAR}, #{websocketMessageContent}
		)
	</insert>

	<select id="list" resultType="WebsocketMessageDto">
		<include refid="top-n-header"></include>
		select * from websocket_message order by websocket_message_no asc	
		<include refid="top-n-footer"></include>		
	</select>

	<!-- 자주 사용하는(ex : Top N Query (페이징)) 구문들을 보관해두고서 불러서 사용 - 구문의 조각은 <sql> 
		태그로 작성 - 이 구문을 불러올 때는 <include>로 작성 - beginRow와 endRow가 있을 때만 구동되도록 설정 : 
		유연하게 처리 -->
	<sql id="top-n-header">
		<if test="beginRow != null and endRow != null">
			select * from (
			select rownum rn, TMP.* from (
		</if>
	</sql>
	<sql id="top-n-footer">
		<if test="beginRow != null and endRow != null">
			) TMP
			) where rn between #{beginRow} and #{endRow}
		</if>
	</sql>

</mapper>